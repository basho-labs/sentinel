version: '2'

services:
  gateway_a:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=gateway"
    ports: 
      - 1883
    networks:
      - net-a
    environment:
      # - ORG_ID=4tlin1
      - DEVICE_TYPE=test-gateway
      - DEVICE_ID=test-gateway-2
      - AUTH_TOKEN=7Q6PwP@EgbAaAjeP_*
    tty: true

  gateway_b:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=gateway"
    ports: 
      - 1883
    networks:
      - net-b
    environment:
      # - ORG_ID=4tlin1
      - DEVICE_TYPE=test-gateway
      - DEVICE_ID=test-gateway-3
      - AUTH_TOKEN=kyYrn8D7wJ1cWR_1hI
    tty: true

  device_a:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=device"
    ports: 
      - 1883
    networks:
      - net-a
    environment:
      - SENTINEL_DEFAULT_GATEWAY=sentinel_gateway_a_1
      - SENTINEL_DEFAULT_NETWORK=net-a
    depends_on:
      - gateway_a
    tty: true

  device_b:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=device"
    ports: 
      - 1883
    networks:
      - net-b
    environment:
      - SENTINEL_DEFAULT_GATEWAY=sentinel_gateway_b_1
      - SENTINEL_DEFAULT_NETWORK=net-b
    depends_on:
      - gateway_b
    tty: true

networks:
  net-a:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.1.1.0/24
  net-b:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.1.2.0/24