version: '2'

services:
  gateway_a:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=gateway"
    ports: 
      - 1883
    networks:
      - net-a
    environment:
      - ORG_ID=4tlin1
      - DEVICE_TYPE=MyGateway
      - DEVICE_ID=test-gw-2
      - AUTH_TOKEN=ZmBFz34H&wNAy@9AxQ
    tty: true

  gateway_b:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=gateway"
    ports: 
      - 1883
    networks:
      - net-b
    environment:
      - ORG_ID=4tlin1
      - DEVICE_TYPE=MyGateway
      - DEVICE_ID=test-gw-3
      - AUTH_TOKEN=vQI1NR+z_CG&)vwT2J
    tty: true

  device_a:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=device"
    ports: 
      - 1883
    networks:
      - net-a
    environment:
      - SENTINEL_DEFAULT_GATEWAY=sentinel_gateway_a_1
      - SENTINEL_DEFAULT_NETWORK=net-a
    depends_on:
      - gateway_a
    tty: true

  device_b:
    build: .
    image: sentinel
    labels:
      - "swarm=dev"
      - "role=device"
    ports: 
      - 1883
    networks:
      - net-b
    environment:
      - SENTINEL_DEFAULT_GATEWAY=sentinel_gateway_b_1
      - SENTINEL_DEFAULT_NETWORK=net-b
    depends_on:
      - gateway_b
    tty: true

  # test:
  #   build: test
  #   image: sentinel-test
  #   networks:
  #     - net-a
  #     - net-b
  #   depends_on:
  #     - gateway
  #     - device_a
  #     - device_b
  #   volumes:
  #     - /var/run/docker.sock:/var/run/docker.sock
  #   tty: true

networks:
  net-a:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.1.1.0/24
  net-b:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 10.1.2.0/24